# 개발 작업 로그 (Factoring Log)

이 문서는 System Implementation Agent가 수행하는 모든 파일 생성, 수정, 삭제 작업을 기록합니다.
---
- 2024-07-25: `src/components/context.py` 파일 생성. `Context` 클래스 및 관련 메서드 구현.
- 2024-07-25: `src/components/code_executor.py` 파일 생성. `CodeExecutor` 클래스 및 `run` 메서드 구현.
- 2024-07-25: `src/components/rag_retriever.py` 파일 생성. `RAGRetriever` 클래스 및 관련 메서드 구현.
- 2024-07-25: `src/prompts/system_prompts.py` 파일 생성. 시스템 프롬프트 상수 4개 추가.
- 2024-07-25: `src/agent.py` 파일 생성. `Agent` 클래스 및 OpenAI API 연동 메서드 구현.
- 2024-07-25: `src/components/code_executor.py` 수정. `run` 메서드가 전역 변수(e.g., `df`)를 받을 수 있도록 변경.
- 2024-07-25: `src/main.py` 파일 생성. Typer CLI 기반의 전체 분석 파이프라인(Orchestrator) 구현.
- 2024-07-25: `Dockerfile` 및 `.dockerignore` 파일 생성. Poetry 프로젝트의 컨테이너화를 위함.
- 2024-07-25: `tests/test_code_executor.py` 파일 생성. `CodeExecutor`의 성공, 실패 및 `global_vars` 사용 사례에 대한 단위 테스트 3개 작성.
- 2024-07-25: `tests/test_rag_retriever.py` 파일 생성. `tmp_path`를 사용한 `RAGRetriever`의 인덱스 빌드 및 쿼리 기능에 대한 단위 테스트 작성.
- 2024-07-25: `src/components/rag_retriever.py` 수정. FAISS 인덱스 차원을 LlamaIndex 기본 임베딩 모델에 맞게 1536으로 변경.
- 2024-07-25: `src/components/rag_retriever.py` 재수정. API 의존성 제거를 위해 로컬 임베딩 모델(`ko-sroberta-multitask`)을 사용하도록 변경.
- 2024-07-25: `resources/knowledge_base`에 `.gitkeep` 파일 추가 및 `RAGRetriever` 안정성 강화(인덱스 로딩 로직 개선, 빈 문서 처리).
- 2024-07-25: 아키텍처 변경: RAG는 로컬 임베딩 모델(`ko-sroberta-multitask`)만 사용하도록 `RAGRetriever`를 리팩토링하고 `BLUEPRINT.md`에 반영.
- 2024-07-25: `tests/test_agent.py` 파일 생성. `mocker`를 사용하여 `_call_api`를 모의 처리하고 `generate_analysis_plan` 메서드 테스트.
- 2024-07-25: `pyproject.toml`에 `python-dotenv` 라이브러리 추가.
- 2024-07-25: `env.example` 파일 생성. RAG 및 LLM 설정을 위한 환경 변수 템플릿 정의.
- 2024-07-25: `output_data/rag_storage` 및 `resources/vector_store` 디렉토리 삭제. RAG 인덱스 저장소 구조 정리.
- 2024-07-25: `src/components/rag_retriever.py` 리팩토링. FAISS 인덱스 로딩/저장 로직 수정 및 `rebuild` 옵션 추가.
- 2024-07-25: `src/main.py` 수정. `.env` 파일 로드 및 `USE_RAG`, `REBUILD_VECTOR_STORE` 환경 변수를 파이프라인에 적용.
- 2024-07-25: `BLUEPRINT.md` 업데이트. `.env` 설정, RAG 제어 옵션, `resources/rag_index` 디렉토리 구조 변경 사항 반영.
- 2024-07-25: **테스트 오류 진단 및 해결**: RAG 테스트 실패 원인이 파일명 불일치임을 발견. `FaissVectorStore`가 `default__vector_store.json`로 저장하는데 테스트에서 `vector_store.json`을 찾고 있었음. 
- 2024-07-25: `tests/test_rag_retriever.py` 수정. 디버깅용 파일 목록 출력 기능 추가 및 올바른 파일명(`default__vector_store.json`) 사용으로 변경.
- 2024-07-25: **전체 테스트 통과 확인**: pytest 실행 결과 모든 8개 테스트 성공. RAG 인덱스 생성, 로딩, 재빌드 기능이 정상적으로 동작함을 검증 완료.
- 2024-07-25: **모듈 경로 문제 해결**: `src/main.py` 실행 시 `ModuleNotFoundError` 해결. `python -m src.main` 방식으로 실행하도록 수정.
- 2024-07-25: `src/agent.py`에 `_clean_code_response()` 메서드 추가. LLM이 생성하는 코드에서 markdown 백틱 제거하여 `SyntaxError` 방지.
- 2024-07-25: **🎉 전체 시스템 동작 성공**: RAG 컨텍스트 강화부터 최종 보고서 생성까지 모든 파이프라인이 정상 동작함을 확인. `normal_sales.csv` 데이터로 A팀과 B팀 성과 차이 분석 완료.
- 2024-07-25: **로깅 시스템 구축**: `src/utils/logger.py` 생성으로 날짜별 상세 로그 파일 저장 및 터미널 출력 간소화 시스템 구현.
- 2024-07-25: `src/main.py` 로깅 시스템 적용. 단계별 진행 상황만 터미널에 표시하고 상세 정보는 `logs/` 디렉토리에 저장.
- 2024-07-25: `src/components/rag_retriever.py` 로깅 개선. print 출력을 파일 로깅으로 대체하여 터미널 출력 정리.
- 2024-07-25: **예제 데이터 생성**: `team_sales_performance.csv`, `customer_survey.csv` 통계 검정용 샘플 데이터 생성.
- 2024-07-25: **✅ 로깅 시스템 동작 확인**: 터미널은 단계별 진행상황만 표시, 상세 로그는 `logs/analysis_YYYYMMDD.log`에 자동 저장. 깔끔한 최종 보고서 출력 완료.
- 2024-07-25: **터미널 출력 완전 정리**: HuggingFace tokenizers, scipy 경고, LlamaIndex 로딩 메시지 등 모든 라이브러리 출력을 숨김 처리.
- 2024-07-25: `src/main.py`, `src/components/code_executor.py`, `src/components/rag_retriever.py`에 경고 및 출력 억제 코드 추가.
- 2024-07-25: **🎯 최종 완성**: 터미널은 단계별 진행 상황과 최종 보고서만 깔끔하게 표시. 모든 기술적 메시지는 로그 파일로 분리 완료.