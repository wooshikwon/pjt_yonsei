{
  "natural_language_request_analysis": {
    "system_prompt": "당신은 Enhanced RAG 시스템을 활용하는 비즈니스 컨텍스트 인식 통계 분석 전문가입니다. 사용자의 자연어 요청을 정확히 파싱하고, 비즈니스 도메인 지식과 DB 스키마 정보를 종합하여 최적의 통계 분석 방법을 추천합니다.",
    "user_prompt_template": "🔍 **자연어 분석 요청 처리** (workflow_node: natural_language_request)\n\n**사용자 요청:** {natural_language_request}\n\n**데이터 컨텍스트:**\n- 데이터셋: {dataset_name}\n- 행 수: {num_rows}행\n- 컬럼 수: {num_columns}개\n- 주요 컬럼: {key_columns}\n- 데이터 타입: {column_types}\n\n**Enhanced RAG 검색 결과:**\n\n**🏢 비즈니스 컨텍스트:**\n{business_context}\n\n**🗄️ DB 스키마 컨텍스트:**\n{schema_context}\n\n**📊 통계 지식 컨텍스트:**\n{statistical_knowledge}\n\n**분석 요청사항:**\n1. 사용자의 자연어 요청을 정확히 파싱하여 분석 목적과 대상 변수를 식별하세요\n2. 비즈니스 컨텍스트를 고려하여 도메인 특화 해석을 제공하세요\n3. DB 스키마 정보를 활용하여 데이터 구조적 제약사항을 고려하세요\n4. 데이터 컬럼과 요청 내용의 매칭 가능성을 확인하세요\n5. 분석 요청이 불명확한 경우 명확화 질문을 생성하세요\n\n**응답 형식:**\n```json\n{\n  \"request_analysis\": {\n    \"parsed_request\": \"파싱된 요청 내용\",\n    \"analysis_type\": \"기술통계|상관분석|그룹비교|회귀분석|범주분석|기타\",\n    \"business_objective\": \"비즈니스 목적\",\n    \"target_variables\": {\n      \"dependent\": [\"종속변수들\"],\n      \"independent\": [\"독립변수들\"],\n      \"grouping\": [\"그룹화 변수들\"]\n    },\n    \"column_mapping\": {\n      \"matched_columns\": [\"매칭된 컬럼들\"],\n      \"missing_columns\": [\"누락된 컬럼들\"]\n    }\n  },\n  \"clarity_assessment\": {\n    \"is_clear\": true,\n    \"clarity_score\": 0.8,\n    \"unclear_aspects\": [\"불명확한 부분들\"]\n  },\n  \"clarification_questions\": [\n    {\n      \"question\": \"명확화 질문\",\n      \"reason\": \"질문 이유\",\n      \"suggested_answers\": [\"제안 답변들\"]\n    }\n  ],\n  \"preliminary_recommendations\": [\n    {\n      \"method_name\": \"통계 방법명\",\n      \"confidence\": 0.9,\n      \"rationale\": \"추천 이유\",\n      \"data_requirements\": [\"데이터 요구사항들\"]\n    }\n  ]\n}\n```",
    "examples": [
      {
        "request": "지역별 매출 차이가 통계적으로 유의한지 확인하고 싶어요",
        "context": "sales_performance.csv, 영업/리테일 도메인, region/sales_amount 컬럼",
        "expected_output": "일원분산분석(ANOVA) 추천, 지역별 세그먼테이션 분석"
      },
      {
        "request": "고객 만족도에 영향을 주는 요인들을 분석해주세요",
        "context": "customer_survey.csv, 고객관리 도메인, satisfaction_score 등",
        "expected_output": "다중회귀분석 추천, 예측모델 구축"
      }
    ]
  },

  "request_clarification": {
    "system_prompt": "당신은 사용자의 불명확한 분석 요청을 명확화하는 전문가입니다. 비즈니스 컨텍스트와 데이터 구조를 고려하여 구체적이고 도움이 되는 질문을 생성합니다.",
    "user_prompt_template": "❓ **요청 명확화** (workflow_node: request_clarification)\n\n**원본 요청:** {original_request}\n**불명확한 부분:** {unclear_aspects}\n\n**데이터 정보:**\n- 사용 가능한 컬럼: {available_columns}\n- 비즈니스 도메인: {business_domain}\n- 스키마 제약사항: {schema_constraints}\n\n**명확화 전략:**\n1. 구체적이고 선택지가 있는 질문을 생성하세요\n2. 비즈니스 맥락에서 이해하기 쉬운 용어를 사용하세요\n3. 데이터 구조를 고려한 실현 가능한 옵션을 제시하세요\n4. 사용자의 분석 목적을 더 명확히 파악할 수 있는 질문을 포함하세요\n\n**응답 형식:**\n```json\n{\n  \"clarification_questions\": [\n    {\n      \"category\": \"분석목적|변수선택|그룹화|비교기준\",\n      \"question\": \"명확하고 구체적인 질문\",\n      \"options\": [\"선택지1\", \"선택지2\", \"선택지3\"],\n      \"default_suggestion\": \"권장 선택지\",\n      \"business_context\": \"비즈니스 관점에서의 설명\"\n    }\n  ],\n  \"suggested_refinements\": [\n    {\n      \"refined_request\": \"개선된 요청 예시\",\n      \"why_better\": \"개선 이유\"\n    }\n  ]\n}\n```",
    "clarification_strategies": [
      "분석 목적 구체화 (탐색적 vs 확증적)",
      "비교 대상 명확화 (그룹, 시점, 조건)",
      "측정 지표 선택 (평균, 비율, 분포)",
      "비즈니스 의사결정 연결"
    ]
  },

  "ai_recommendation_generation": {
    "system_prompt": "당신은 Enhanced RAG 시스템의 비즈니스 컨텍스트와 DB 스키마 정보를 종합하여 최적의 통계 분석 방법을 추천하는 AI 전문가입니다. workflow_graph.json의 ai_recommendation_generation 단계를 수행합니다.",
    "user_prompt_template": "🧠 **AI 분석 방법 추천 생성** (workflow_node: ai_recommendation_generation)\n\n**분석 컨텍스트:**\n- 명확화된 요청: {clarified_request}\n- 분석 유형: {analysis_type}\n- 대상 변수: {target_variables}\n- 데이터 특성: {data_characteristics}\n\n**Enhanced RAG 컨텍스트:**\n**비즈니스 지식:** {business_knowledge}\n**스키마 정보:** {schema_info}\n**통계 방법론:** {statistical_methods}\n\n**데이터 품질 정보:**\n- 결측치 비율: {missing_rate}\n- 이상치 탐지 결과: {outlier_info}\n- 데이터 분포: {distribution_info}\n\n**추천 기준 (가중치):**\n1. 비즈니스 목적 적합성 (40%)\n2. 데이터 특성 일치성 (30%)\n3. 통계적 엄밀성 (20%)\n4. 해석 용이성 (10%)\n\n**요구사항:**\n- 추천도 95% 이상인 주 방법 1개 필수\n- 추천도 80% 이상인 대안 방법 1-2개\n- 각 방법별 상세한 적용 근거와 전제조건\n- 비즈니스 해석 가이드라인\n- DB 스키마 제약조건 반영\n\n**응답 형식:**\n```json\n{\n  \"primary_recommendation\": {\n    \"method_name\": \"통계 방법명\",\n    \"method_category\": \"descriptive|inferential|predictive\",\n    \"confidence_score\": 0.95,\n    \"business_rationale\": \"비즈니스 관점 추천 이유\",\n    \"statistical_rationale\": \"통계학적 추천 이유\",\n    \"schema_compatibility\": \"스키마 호환성 설명\",\n    \"assumptions\": [\n      {\n        \"assumption\": \"가정명\",\n        \"check_method\": \"검정방법\",\n        \"violation_alternative\": \"위반시 대안\"\n      }\n    ],\n    \"expected_outputs\": [\"예상 결과물들\"],\n    \"business_interpretation_guide\": \"결과 해석 가이드\"\n  },\n  \"alternative_recommendations\": [\n    {\n      \"method_name\": \"대안 방법명\",\n      \"confidence_score\": 0.85,\n      \"when_to_use\": \"사용 조건\",\n      \"pros_cons\": {\n        \"pros\": [\"장점들\"],\n        \"cons\": [\"단점들\"]\n      }\n    }\n  ],\n  \"preprocessing_requirements\": [\n    {\n      \"step\": \"전처리 단계\",\n      \"description\": \"상세 설명\",\n      \"code_snippet\": \"Python 코드 예시\"\n    }\n  ],\n  \"risk_assessments\": [\n    {\n      \"risk\": \"위험 요소\",\n      \"probability\": \"high|medium|low\",\n      \"mitigation\": \"완화 방안\"\n    }\n  ]\n}\n```",
    "recommendation_matrix": {
      "group_comparison": ["t-test", "ANOVA", "Mann-Whitney", "Kruskal-Wallis"],
      "correlation": ["Pearson", "Spearman", "Kendall"],
      "regression": ["Linear", "Logistic", "Polynomial", "Ridge"],
      "categorical": ["Chi-square", "Fisher", "McNemar"]
    }
  }
} 