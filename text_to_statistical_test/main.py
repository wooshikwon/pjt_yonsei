#!/usr/bin/env python3
"""
ğŸ”¬ Statistical Analysis Assistant
ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ AI í†µê³„ ë¶„ì„ ì‹œìŠ¤í…œ

LLM Agent + Enhanced RAG ì‹œìŠ¤í…œ ê¸°ë°˜ìœ¼ë¡œ ì‚¬ìš©ìì˜ ìì—°ì–´ ë¶„ì„ ìš”ì²­ì„ ë°›ì•„ 
ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ì§€ì‹ê³¼ DB ìŠ¤í‚¤ë§ˆ êµ¬ì¡°ë¥¼ í™œìš©í•˜ì—¬ ìµœì ì˜ í†µê³„ ë¶„ì„ ë°©ë²•ì„ ì¶”ì²œí•˜ê³  
ìë™í™”ëœ ì „ì œì¡°ê±´ ê²€ì¦ê³¼ í•¨ê»˜ í†µê³„ ë¶„ì„ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
"""

import argparse
import sys
import logging
from pathlib import Path

# í˜„ì¬ ë””ë ‰í† ë¦¬ë¥¼ Python ê²½ë¡œì— ì¶”ê°€
sys.path.insert(0, str(Path(__file__).parent))

from utils import (
    setup_dependencies, validate_settings, 
    run_interactive_mode, print_welcome_message
)


def create_argument_parser():
    """ëª…ë ¹í–‰ ì¸ìˆ˜ íŒŒì„œ ìƒì„± - ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ìì—°ì–´ ìš”ì²­ ê¸°ë°˜ ë¶„ì„"""
    parser = argparse.ArgumentParser(
        description='ğŸ”¬ Statistical Analysis Assistant - ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ AI í†µê³„ ë¶„ì„ ì‹œìŠ¤í…œ',
        formatter_class=argparse.RawDescriptionHelpFormatter,
        epilog="""
ğŸ¢ Enhanced RAG ê¸°ë°˜ ì›Œí¬í”Œë¡œìš°:
  1. ğŸ“ input_data/data_files í´ë”ì˜ ë°ì´í„° íŒŒì¼ ëª©ë¡ í‘œì‹œ â†’ ì‚¬ìš©ì ì„ íƒ
  2. ğŸ“Š ë°ì´í„° ë¡œë”© ì™„ë£Œ ë° ê¸°ë³¸ ì •ë³´ í™•ì¸
  3. ğŸ—£ï¸ ì‚¬ìš©ìê°€ ìì—°ì–´ë¡œ ë¶„ì„ ìš”ì²­ ì…ë ¥
  4. ğŸ” RAG ì‹œìŠ¤í…œ í™œì„±í™”:
     â€¢ ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ì§€ì‹ ê²€ìƒ‰ (business_dictionary, domain_knowledge)
     â€¢ DB ìŠ¤í‚¤ë§ˆ êµ¬ì¡° ê²€ìƒ‰ (schema_definitions, relationship_maps)
  5. ğŸ§  AIê°€ ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê³ ë ¤í•˜ì—¬ ìµœì  í†µê³„ ê¸°ë²• 1~3ê°œ ì¶”ì²œ
  6. ğŸ‘¤ ì‚¬ìš©ìê°€ ì¶”ì²œ ë°©ë²• ì¤‘ ì„ íƒ
  7. ğŸ¤– ìë™í™”ëœ ì „ì œì¡°ê±´ ê²€ì¦ ë° í†µê³„ ë¶„ì„ ìˆ˜í–‰ (ì •ê·œì„±, ë“±ë¶„ì‚°ì„± ë“±)
  8. ğŸ“„ ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸ í¬í•¨ ê²°ê³¼ ë³´ê³ ì„œ ìƒì„±

ì‚¬ìš© ì˜ˆì‹œ:
  poetry run python main.py                    # ê¸°ë³¸ ëŒ€í™”í˜• ëª¨ë“œ
  poetry run python main.py --data sales.csv   # íŠ¹ì • ë°ì´í„°ë¡œ ì‹œì‘
  poetry run python main.py --verbose          # ìƒì„¸ ë¡œê¹… í¬í•¨  
  poetry run python main.py --no-welcome       # í™˜ì˜ ë©”ì‹œì§€ ìƒëµ

Docker ì‹¤í–‰:
  docker build -t statistical-assistant .
  docker run -it statistical-assistant

ğŸ—£ï¸ ìì—°ì–´ ë¶„ì„ ìš”ì²­ ì˜ˆì‹œ (ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ë³„):

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“Š ê·¸ë£¹ ë¹„êµ ë¶„ì„                                               â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ "ì§€ì—­ë³„ ë§¤ì¶œ ì°¨ì´ê°€ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œì§€ í™•ì¸í•˜ê³  ì‹¶ì–´ìš”"       â”‚
â”‚ â€¢ "ë¶€ì„œë³„ ì§ì› ë§Œì¡±ë„ì— ì°¨ì´ê°€ ìˆë‚˜ìš”?"                         â”‚
â”‚ â€¢ "ë¸Œëœë“œë³„ ê³ ê° ì¶©ì„±ë„ ì ìˆ˜ë¥¼ ë¹„êµí•´ì£¼ì„¸ìš”"                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ”— ê´€ê³„ ë° ìƒê´€ê´€ê³„ ë¶„ì„                                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ "ê´‘ê³ ë¹„ì™€ ë§¤ì¶œ ê°„ì˜ ìƒê´€ê´€ê³„ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”"                  â”‚
â”‚ â€¢ "ê³ ê° ë§Œì¡±ë„ì™€ ì¬êµ¬ë§¤ìœ¨ ì‚¬ì´ì˜ ê´€ê³„ë¥¼ ì•Œê³  ì‹¶ìŠµë‹ˆë‹¤"          â”‚
â”‚ â€¢ "ê·¼ë¬´ì‹œê°„ê³¼ ìƒì‚°ì„± ì§€í‘œ ê°„ ê´€ë ¨ì„±ì„ í™•ì¸í•´ì£¼ì„¸ìš”"             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ“ˆ ì˜ˆì¸¡ ë° íšŒê·€ ë¶„ì„                                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ "ì—¬ëŸ¬ ë§ˆì¼€íŒ… ìš”ì¸ë“¤ì´ ë§¤ì¶œì— ë¯¸ì¹˜ëŠ” ì˜í–¥ì„ ë¶„ì„í•´ì£¼ì„¸ìš”"      â”‚
â”‚ â€¢ "ê³ ê° íŠ¹ì„±ì„ ë°”íƒ•ìœ¼ë¡œ êµ¬ë§¤ í™•ë¥ ì„ ì˜ˆì¸¡í•˜ê³  ì‹¶ì–´ìš”"            â”‚
â”‚ â€¢ "ì œí’ˆ íŠ¹ì§•ë“¤ì´ ê°€ê²©ì— ë¯¸ì¹˜ëŠ” ì˜í–¥ë„ë¥¼ ì•Œì•„ë³´ì„¸ìš”"             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ¢ ë¹„ì¦ˆë‹ˆìŠ¤ ì˜ì‚¬ê²°ì • ë¶„ì„                                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ "ìƒˆë¡œìš´ ë§ˆì¼€íŒ… ì „ëµì˜ íš¨ê³¼ë¥¼ ê²€ì¦í•˜ê³  ì‹¶ìŠµë‹ˆë‹¤"               â”‚
â”‚ â€¢ "A/B í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ í†µê³„ì ìœ¼ë¡œ ìœ ì˜í•œì§€ í™•ì¸í•´ì£¼ì„¸ìš”"          â”‚
â”‚ â€¢ "ê³ ê° ì„¸ê·¸ë¨¼íŠ¸ë³„ êµ¬ë§¤ íŒ¨í„´ ì°¨ì´ë¥¼ ë¶„ì„í•´ì£¼ì„¸ìš”"               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ğŸ—ï¸ ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ë©”íƒ€ë°ì´í„° í™œìš©:
  â€¢ input_data/metadata/business_dictionary.json - ì—…ê³„ ìš©ì–´ì‚¬ì „
  â€¢ input_data/metadata/domain_knowledge.md - ë„ë©”ì¸ ì „ë¬¸ ì§€ì‹
  â€¢ input_data/metadata/database_schemas/ - DB ìŠ¤í‚¤ë§ˆ êµ¬ì¡° ì •ë³´
        """
    )
    
    # ë°ì´í„° íŒŒì¼ ì˜µì…˜
    parser.add_argument(
        '--data', '--input-data',
        type=str,
        help='ë¶„ì„í•  ë°ì´í„° íŒŒì¼ ê²½ë¡œ (input_data/data_files í´ë” ë‚´)'
    )
    
    # ì‹œìŠ¤í…œ ì˜µì…˜
    parser.add_argument(
        '--verbose', '-v',
        action='store_true',
        help='ìƒì„¸í•œ ë¡œê¹… ì¶œë ¥ (ë””ë²„ê¹…ìš©)'
    )
    
    parser.add_argument(
        '--no-welcome',
        action='store_true',
        help='í™˜ì˜ ë©”ì‹œì§€ ë° ì›Œí¬í”Œë¡œìš° ê°€ì´ë“œ ìƒëµ'
    )
    
    return parser


def print_startup_info():
    """ì‹œì‘ ì‹œ ì‹œìŠ¤í…œ ì •ë³´ ì¶œë ¥ - Enhanced RAG ì‹œìŠ¤í…œ ê°•ì¡°"""
    print("\nğŸ”¬========================================================ğŸ”¬")
    print("   ğŸ“Š Statistical Analysis Assistant ğŸ“Š")
    print("    ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ AI í†µê³„ ë¶„ì„ ì‹œìŠ¤í…œ")
    print("ğŸ”¬========================================================ğŸ”¬")
    print()
    print("ğŸ§  Enhanced RAG ì‹œìŠ¤í…œ íŠ¹ì§•:")
    print("  ğŸ¢ ë¹„ì¦ˆë‹ˆìŠ¤ ë„ë©”ì¸ ì§€ì‹ ê²€ìƒ‰")
    print("  ğŸ—„ï¸ DB ìŠ¤í‚¤ë§ˆ êµ¬ì¡° ì •ë³´ í™œìš©")
    print("  ğŸŒ BCEmbedding ê¸°ë°˜ í•œì¤‘ ì´ì¤‘ì–¸ì–´ ì§€ì›")
    print()
    print("ğŸ“‹ ì›Œí¬í”Œë¡œìš°:")
    print("  1. ğŸ“ ë°ì´í„° íŒŒì¼ ì„ íƒ (input_data/data_files)")
    print("  2. ğŸ—£ï¸ ìì—°ì–´ ë¶„ì„ ìš”ì²­ ì…ë ¥")
    print("  3. ğŸ” RAG ì‹œìŠ¤í…œ í™œì„±í™” (ë¹„ì¦ˆë‹ˆìŠ¤ ì§€ì‹ + DB ìŠ¤í‚¤ë§ˆ)")
    print("  4. ğŸ§  AI ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ë¶„ì„ ë°©ë²• ì¶”ì²œ (1~3ê°œ)")
    print("  5. ğŸ¤– ìë™í™”ëœ í†µê³„ ë¶„ì„ ìˆ˜í–‰ (ê°€ì • ê²€ì • í¬í•¨)")
    print("  6. ğŸ“„ ë¹„ì¦ˆë‹ˆìŠ¤ ì¸ì‚¬ì´íŠ¸ í¬í•¨ ê²°ê³¼ ë³´ê³ ì„œ ìƒì„±")
    print()


def validate_business_context_setup():
    """ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ë° RAG ì‹œìŠ¤í…œ í™˜ê²½ ê²€ì¦"""
    issues = []
    warnings = []
    
    # ê¸°ë³¸ input_data êµ¬ì¡° í™•ì¸
    input_data_path = Path("input_data")
    if not input_data_path.exists():
        issues.append("input_data í´ë”ê°€ ì¡´ì¬í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤")
    
    # ë°ì´í„° íŒŒì¼ í´ë” í™•ì¸
    data_files_path = input_data_path / "data_files"
    if not data_files_path.exists():
        warnings.append("input_data/data_files í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤ (ë¶„ì„í•  ë°ì´í„° íŒŒì¼ ìœ„ì¹˜)")
    
    # ë©”íƒ€ë°ì´í„° í´ë” êµ¬ì¡° í™•ì¸
    metadata_path = input_data_path / "metadata"
    if not metadata_path.exists():
        warnings.append("input_data/metadata í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤ (ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ì •ë³´)")
    else:
        # ë¹„ì¦ˆë‹ˆìŠ¤ ì§€ì‹ íŒŒì¼ë“¤ í™•ì¸
        business_files = {
            "business_dictionary.json": "ì—…ê³„ ìš©ì–´ì‚¬ì „",
            "domain_knowledge.md": "ë„ë©”ì¸ ì „ë¬¸ ì§€ì‹",
            "analysis_guidelines.md": "ë¶„ì„ ê°€ì´ë“œë¼ì¸"
        }
        
        for file_name, description in business_files.items():
            if not (metadata_path / file_name).exists():
                warnings.append(f"{file_name} íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤ ({description})")
        
        # DB ìŠ¤í‚¤ë§ˆ í´ë” í™•ì¸
        schema_path = metadata_path / "database_schemas"
        if not schema_path.exists():
            warnings.append("database_schemas í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤ (DB ìŠ¤í‚¤ë§ˆ êµ¬ì¡° ì •ë³´)")
        else:
            schema_files = {
                "schema_definitions.json": "í…Œì´ë¸” êµ¬ì¡° ì •ì˜",
                "relationship_maps.json": "í…Œì´ë¸” ê´€ê³„ ë§¤í•‘", 
                "column_descriptions.json": "ì»¬ëŸ¼ ìƒì„¸ ì„¤ëª…"
            }
            
            for file_name, description in schema_files.items():
                if not (schema_path / file_name).exists():
                    warnings.append(f"database_schemas/{file_name} íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤ ({description})")
    
    # RAG ì¸ë±ìŠ¤ í´ë” í™•ì¸
    rag_index_path = Path("resources/rag_index")
    if not rag_index_path.exists():
        warnings.append("RAG ì¸ë±ìŠ¤ í´ë”ê°€ ì—†ìŠµë‹ˆë‹¤ (ìµœì´ˆ ì‹¤í–‰ ì‹œ ìë™ ìƒì„±ë©ë‹ˆë‹¤)")
    
    return issues, warnings


def main():
    """ë©”ì¸ ì‹¤í–‰ í•¨ìˆ˜ - ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ìì—°ì–´ ìš”ì²­ ê¸°ë°˜ AI ì¶”ì²œ ë¶„ì„"""
    try:
        # ëª…ë ¹í–‰ ì¸ìˆ˜ íŒŒì‹±
        parser = create_argument_parser()
        args = parser.parse_args()
        
        # ë¡œê¹… ë ˆë²¨ ì„¤ì •
        if args.verbose:
            logging.basicConfig(
                level=logging.DEBUG,
                format='%(asctime)s - %(name)s - %(levelname)s - %(message)s'
            )
        else:
            logging.basicConfig(
                level=logging.WARNING,
                format='%(levelname)s - %(message)s'
            )
        
        # í™˜ì˜ ë©”ì‹œì§€ ë° ì‹œì‘ ì •ë³´ ì¶œë ¥
        if not args.no_welcome:
            print_startup_info()
            print_welcome_message()
        
        # OpenAI API í™˜ê²½ ì„¤ì • ê²€ì¦
        print("ğŸ”§ OpenAI API í™˜ê²½ ì„¤ì • ê²€ì¦ ì¤‘...")
        try:
            validate_settings()
            print("âœ… OpenAI API ì„¤ì • ì™„ë£Œ!")
        except Exception as e:
            print(f"âŒ í™˜ê²½ ì„¤ì • ì˜¤ë¥˜: {e}")
            print("ğŸ“‹ í•´ê²° ë°©ë²•:")
            print("1. .env íŒŒì¼ì´ ì¡´ì¬í•˜ëŠ”ì§€ í™•ì¸")
            print("2. ì˜¬ë°”ë¥¸ OPENAI_API_KEYê°€ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸") 
            print("3. OPENAI_MODEL=gpt-4oë¡œ ì„¤ì •ë˜ì—ˆëŠ”ì§€ í™•ì¸")
            print("4. poetry run python setup_project.pyë¥¼ ì‹¤í–‰í•˜ì—¬ ì´ˆê¸° ì„¤ì • ìˆ˜í–‰")
            return 1
        
        # ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ë° RAG ì‹œìŠ¤í…œ í™˜ê²½ ê²€ì¦
        print("ğŸ¢ ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ë° RAG ì‹œìŠ¤í…œ í™˜ê²½ ê²€ì¦ ì¤‘...")
        issues, warnings = validate_business_context_setup()
        
        if issues:
            print("âŒ ì¹˜ëª…ì ì¸ ë¬¸ì œ ë°œê²¬:")
            for issue in issues:
                print(f"   â€¢ {issue}")
            print("ğŸ“‹ poetry run python setup_project.pyë¥¼ ì‹¤í–‰í•˜ì—¬ í”„ë¡œì íŠ¸ë¥¼ ì´ˆê¸°í™”í•´ì£¼ì„¸ìš”.")
            return 1
        
        if warnings:
            print("âš ï¸ ì£¼ì˜ì‚¬í•­ (ì„ íƒì  ê¸°ëŠ¥):")
            for warning in warnings:
                print(f"   â€¢ {warning}")
            print("ğŸ’¡ ì™„ì „í•œ ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ê¸°ëŠ¥ì„ ìœ„í•´ì„œëŠ” setup_project.py ì‹¤í–‰ì„ ê¶Œì¥í•©ë‹ˆë‹¤.")
            print()
        else:
            print("âœ… ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ í™˜ê²½ ì„¤ì • ì™„ë£Œ!")
        
        # ì‹œìŠ¤í…œ ì˜ì¡´ì„± ë° RAG ì‹œìŠ¤í…œ ì´ˆê¸°í™”
        print("ğŸ”¨ ì‹œìŠ¤í…œ ì»´í¬ë„ŒíŠ¸ ë° Enhanced RAG ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì¤‘...")
        print("   ğŸ“¥ BCEmbedding ëª¨ë¸ ë¡œë”©...")
        print("   ğŸ—„ï¸ ë¹„ì¦ˆë‹ˆìŠ¤ ì§€ì‹ë² ì´ìŠ¤ ì¸ë±ì‹±...")
        print("   ğŸ”— DB ìŠ¤í‚¤ë§ˆ ì •ë³´ ë§¤í•‘...")
        try:
            dependencies = setup_dependencies()
            print("âœ… Enhanced RAG ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì™„ë£Œ!")
        except Exception as e:
            print(f"âŒ ì‹œìŠ¤í…œ ì´ˆê¸°í™” ì‹¤íŒ¨: {e}")
            if args.verbose:
                import traceback
                traceback.print_exc()
            print("ğŸ’¡ ì„ë² ë”© ëª¨ë¸ ë‹¤ìš´ë¡œë“œ ì¤‘ì¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì ì‹œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.")
            return 1
        
        # ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ìì—°ì–´ ìš”ì²­ ê¸°ë°˜ ëŒ€í™”í˜• ëª¨ë“œ ì‹¤í–‰
        print("ğŸš€ ë¹„ì¦ˆë‹ˆìŠ¤ ì»¨í…ìŠ¤íŠ¸ ì¸ì‹ ë¶„ì„ ëª¨ë“œë¥¼ ì‹œì‘í•©ë‹ˆë‹¤...")
        print("ğŸ¢ ì—…ê³„ ì§€ì‹ ë° DB ìŠ¤í‚¤ë§ˆ ì •ë³´ë¥¼ í™œìš©í•œ ì§€ëŠ¥í˜• ë¶„ì„ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.")
        print("=" * 70)
        run_interactive_mode(dependencies, args.data)
        
        return 0
        
    except KeyboardInterrupt:
        print("\n\nğŸ‘‹ ì‚¬ìš©ìê°€ í”„ë¡œê·¸ë¨ì„ ì¤‘ë‹¨í–ˆìŠµë‹ˆë‹¤.")
        print("ë¶„ì„ ì„¸ì…˜ì´ ì•ˆì „í•˜ê²Œ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.")
        return 0
    except Exception as e:
        print(f"âŒ ì˜ˆìƒì¹˜ ëª»í•œ ì˜¤ë¥˜: {e}")
        if args.verbose if 'args' in locals() else False:
            import traceback
            traceback.print_exc()
        return 1


if __name__ == "__main__":
    exit_code = main()
    sys.exit(exit_code) 